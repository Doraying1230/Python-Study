<html>
<head>
  <title>Python2 JSON.load成Unicode的坑</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="813"/>
<h1>Python2 JSON.load成Unicode的坑</h1>

<div>
<span><div style="box-sizing: border-box; padding: 30px 0px 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><div style="box-sizing: border-box; margin-right: auto; margin-left: auto; padding-left: 15px; padding-right: 15px; width: 1140px;"><div style="box-sizing: border-box; padding-bottom: 20px; border-bottom: 1px solid rgb(224, 224, 224);"><div style="box-sizing: border-box; margin-left: -15px; margin-right: -15px;"><div style="box-sizing: border-box; position: relative; min-height: 1px; padding-left: 15px; padding-right: 15px; float: left; width: 855px;"><div style="box-sizing: border-box; color: rgb(153, 153, 153); margin-bottom: -5px; margin-left: 0px !important;"><h1 style="box-sizing: border-box; font-size: 24px; margin: 0px 0px 15px; font-family: inherit; font-weight: 500; color: inherit;"><a href="https://segmentfault.com/a/1190000002779638" style="box-sizing: border-box; background: transparent; color: rgb(51, 51, 51); text-decoration: none; outline: 0px;">Python2 JSON.load成Unicode的坑</a></h1><div style="box-sizing: border-box;"><ul style="box-sizing: border-box; margin-top: 0px; margin-bottom: 0px; display: inline-block; margin-right: 10px !important; list-style: none; padding: 0px; font-size: 0px;"><li style="box-sizing: border-box; margin-bottom: 5px !important; padding: 0px; font-size: 13px; display: inline-block; margin-right: 5px;"><a href="https://segmentfault.com/t/unicode/blogs" style="box-sizing: border-box; background: rgba(1, 126, 102, 0.08); color: rgb(1, 126, 102); text-decoration: none; outline: 0px; display: inline-block; padding: 0px 8px; height: 24px; font-weight: normal; font-size: 13px; text-align: center;">unicode</a></li><li> </li><li style="box-sizing: border-box; margin-bottom: 5px !important; padding: 0px; font-size: 13px; display: inline-block; margin-right: 0px;"><a href="https://segmentfault.com/t/python/blogs" style="box-sizing: border-box; background: rgba(1, 126, 102, 0.08); color: rgb(1, 126, 102); text-decoration: none; outline: 0px; display: inline-block; padding: 0px 8px; height: 24px; font-weight: normal; font-size: 13px; text-align: center;">python</a></li></ul>
 
<div style="box-sizing: border-box; display: inline-block;"><a href="https://segmentfault.com/u/kamushin" style="box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration: none; outline: 0px; margin-right: 5px !important;"><strong style="box-sizing: border-box; font-weight: bold;">kamushin233</strong></a> 2015年05月20日发布</div></div></div></div><div style="box-sizing: border-box; position: relative; min-height: 1px; padding-left: 15px; padding-right: 15px; float: left; width: 285px;"><ul style="box-sizing: border-box; margin: 0px; padding-left: 0px; list-style: none; color: rgb(153, 153, 153);"><li style="box-sizing: border-box; margin-top: 0px;"> </li><li style="box-sizing: border-box; margin-top: 10px;"><strong style="box-sizing: border-box; font-weight: normal; color: rgb(51, 51, 51);">6.2k</strong> 次浏览</li></ul></div></div></div></div></div><div style="box-sizing: border-box; margin-right: auto; margin-left: auto; padding-left: 15px; padding-right: 15px; width: 1140px; margin-top: 30px !important; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><div style="box-sizing: border-box; margin-left: -15px; margin-right: -15px;"><div style="box-sizing: border-box; position: relative; min-height: 1px; padding-left: 15px; padding-right: 15px; float: left; width: 855px;"><div style="box-sizing: border-box; word-wrap: break-word;"><p style="box-sizing: border-box; margin: 0px 0px 1.5em;">我是接口调用方，今天在联调的时候，接口方的同学问我传过来的json是神马玩意，怎么每个item前还带个u的。<br style="box-sizing: border-box;"/>
我看了一眼，我靠，还真是带个u的，自己调试的时候楞是没发现。也怪自己以前没怎么遇到过Python的编码坑，这次重新用起Python2来，一不小心就踩进坑了。<br style="box-sizing: border-box;"/>
一通debug发现是<span style="color: rgb(209, 0, 255);"><span style="font-size: 19px;">Python自带的Json库会把json文件load成Unicode对象。如果想要变成str对象的话，就要自己去encode</span></span>。<br style="box-sizing: border-box;"/>
祭出so大法...#请叫我so搬运工</p><pre style="box-sizing: border-box; overflow: auto; font-family: &quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 0.93em; display: block; padding: 1em; margin-top: 0px !important; margin-right: 0px; margin-bottom: 1.5em; margin-left: 0px; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background: url(&quot;../img/blueprint.png&quot;) 0% 0% / 30px rgb(246, 246, 246), 0% 0% / 30px; border: none; border-radius: 4px; max-height: 35em; position: relative;"><code style="box-sizing: border-box; font-family: &quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 1em; padding: 0px; color: inherit; background: none; border-radius: 0px; white-space: inherit; overflow-wrap: normal;">def byteify(<span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">input</span>):
    <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">if</span> isinstance(<span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">input</span>, dict):
        <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">return</span> {byteify(key):byteify(value) <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">for</span> key,value <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">in</span> <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">input</span>.iteritems()}
    elif isinstance(<span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">input</span>, <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">list</span>):
        <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">return</span> [byteify(element) <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">for</span> element <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">in</span> <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">input</span>]
    elif isinstance(<span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">input</span>, unicode):
        <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">return</span> <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">input</span>.<span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">encode</span>('utf-8')
    <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">else</span>:
        <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">return</span> <span style="box-sizing: border-box; color: rgb(51, 51, 51); font-weight: bold;">input</span></code></pre><div><br/></div><div style="box-sizing: border-box; margin: 1.5em 0px 0px;"><div>这个函数递归的把list和dict里的Unicode对象encode成str。 当然，我不觉得这是the right way。使用yaml里的json来代替官方自带的json可能更好。</div></div></div></div></div></div></span>
</div></body></html> 