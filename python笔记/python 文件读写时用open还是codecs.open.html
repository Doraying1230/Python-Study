<html>
<head>
  <title>python 文件读写时用open还是codecs.open</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="799"/>
<h1>python 文件读写时用open还是codecs.open</h1>

<div>
<span><div><a href="http://www.cnblogs.com/buptldf/p/4805879.html">http://www.cnblogs.com/buptldf/p/4805879.html</a></div><div><br/></div><div style="margin-bottom: 10px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="color: rgb(75, 75, 75);"><span style="font-size: 15px;"><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><b><a href="http://www.cnblogs.com/buptldf/p/4805879.html" style="text-decoration: none; color: rgb(26, 139, 200);">python 文件读写时用open还是codecs.open</a></b></span></span></span></div><div><span style="color: rgb(75, 75, 75);"><span style="font-size: 15px;"><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><b><br/></b></span></span></span></div><div><span style="color: rgb(75, 75, 75);"><span style="font-size: 15px;"><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><b><br/></b></span></span></span></div><div><span style="color: rgb(75, 75, 75);"><span style="font-size: 15px;"><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><b><br/></b></span></span></span></div><div><span style="color: rgb(75, 75, 75);"><span style="font-size: 15px;"><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><b>import codecs</b></span></span></span></div><div><span style="color: rgb(75, 75, 75);"><span style="font-size: 15px;"><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><b>with codecs.open('C:\Users\Administrator\Desktop\ziji.txt', 'r',encoding='gbk') as f:</b></span></span></span></div><div><span style="color: rgb(75, 75, 75);"><span style="font-size: 15px;"><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><b>    print f.read()</b></span></span></span></div><div><span style="color: rgb(75, 75, 75);"><span style="font-size: 15px;"><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><b><br/></b></span></span></span></div><div><b><span style="font-size: 19px;">with codecs.open('C:\Users\Administrator\Desktop\ziji.txt', 'w',encoding='gbk') as f:</span></b></div><div><b><span style="font-size: 19px;">    print f.read(u‘中国’)</span></b></div><div>用<b><span style="font-size: 19px;">codecs.open（）方法打开读取时必须是gbk编码的代码</span></b></div><div>用<b><span style="font-size: 19px;">codecs.open（）方法打开写入时必须是unicode编码的代码</span></b></div><div><b><span style="font-size: 19px;"><br/></span></b></div><div><span style="color: rgb(75, 75, 75);"><span style="font-size: 15px;"><span style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><b><br/></b></span></span></span></div></div><div style="margin-bottom: 20px; word-break: break-word; color: rgb(75, 75, 75); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><p style="margin: 10px auto; text-indent: 0px;">     当我面有数据需要保存时，第一时间一般会想到写到一个txt文件中，当然，数据量比较大的时候还是写到数据库比较方便管理，需要进行网络传输时要序列化，json化。下面主要整理一下平时用的最多的写入到文件中，一般以txt结尾，linux里不会以后缀来区分文件类型，后缀可以随便，也可以没有。</p><p style="margin: 10px auto; text-indent: 0px;">      python读写文件估计大家都用open内置函数，或者file这个工厂函数，这两个的效果基本一样。</p><p style="margin: 10px auto; text-indent: 0px;">      打开文件的方式一般为：f=open(file_name,access_mode = <span style="color: rgb(128, 0, 0);">'<span style="color: rgb(128, 0, 0);">r<span style="color: rgb(128, 0, 0);">',buffering = -1)。file_name就是文件的路径加文件名字，不加路径则文件会存放在python程序的路径下，</span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">access_mode就是操作文件的模式，主要有r,w,rb，wb等，细节网上一大堆<span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">,buffering = -1是用于指示访问文件所采用的缓存方式。0表示不缓存；1表示只缓存一行，n代表缓存n行。如果不提供或为负数，则代表使用系统默认的缓存机制。</span></span></span></span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">      打开以后就是写和读的操作。但是用open方法打开会有一些问题。open打开文件只能写入str类型,不管字符串是什么编码方式。例如</span></span></span></span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">&gt;&gt;&gt; fr = open('test.txt','a')<br/>
&gt;&gt;&gt; line1 = &quot;我爱祖国&quot;<br/>
&gt;&gt;&gt; fr.write(line1)</span></span></span></span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">这样是完全可以的。但是有时候我们爬虫或者其他方式得到一些数据写入文件时会有编码不统一的问题，所以就一般都统一转换为unicode。此时写入open方式打开的文件就有问题了。例如</span></span></span></span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">&gt;&gt;&gt; line2 = u'我爱祖国'<br/>
&gt;&gt;&gt; fr.write(line2)<br/><br/>
Traceback (most recent call last):<br/>
  File &quot;&lt;pyshell#4&gt;&quot;, line 1, in &lt;module&gt;<br/>
    fr.write(line2)<br/>
UnicodeEncodeError: 'ascii' codec can't encode characters in position 0-11: ordinal not in range(128)<br/>
&gt;&gt;&gt;</span></span></span></span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">怎么办，我们可以将上面的line2编码成str类型，但是太麻烦。我们要把得到的东西先decode为unicode再encode为str。。。</span></span></span></span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">input文件(gbk, utf-8...)   ----decode-----&gt;   unicode  -------encode------&gt; output文件(gbk, utf-8...)</span></span></span></span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">代替这繁琐的操作就是codecs.open，例如<br/></span></span></span></span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">&gt;&gt;&gt; import codecs<br/>
&gt;&gt;&gt; fw = codecs.open('test1.txt','a','utf-8')<br/>
&gt;&gt;&gt; fw.write(line2)<br/>
&gt;&gt;&gt;</span></span></span></span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">不会报错，说明写入成功。这种方法<span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">可以指定一个编码打开文件，使用这个方法打开的文件读取返回的将是unicode。写入时，如果参数 是unicode，则使用open()时指定的编码进行编码后写入；如果是str，则先根据源代码文件声明的字符编码，解码成unicode后再进行前述 操作。相对内置的open()来说，这个方法比较不容易在编码上出现问题。</span></span></span></span></span></span></span></span></span></span></span></span></p><p style="margin: 10px auto; text-indent: 0px;"> </p><div style="margin: 10px auto; text-indent: 0px;"><div><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);"><span style="color: rgb(128, 0, 0);">总结一下：文件读尽量用第二种方法，一般不会出现编码的问题。至于用第二种方法有什么缺点，我没有研究过。。</span></span></span></span></span></span></span></span></span></span></span></span></div></div></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 